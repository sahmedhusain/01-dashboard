import{r as u,j as e,m as l}from"./animation-vendor-w_1g82yL.js";import{L as X,f as P,b as J}from"./index-JD0zl7sY.js";import{c as O}from"./allQueries-C1LmK1xE.js";import{j as I,z as R,y as S,I as Y,U as y,t as L,x as Z,N as ee,a1 as te,a2 as se,m as ae,e as re,d as ie,J as ne,w as le,W as oe,Q as de}from"./ui-vendor-CAUkr1F8.js";import{d as C,e as E}from"./apollo-vendor-8AJvV5pX.js";import"./react-vendor-DJG_os-6.js";const ce=E`
  query GetAuditData($userId: Int!, $limit: Int = 50, $offset: Int = 0) {
    auditsGiven: audit(
      where: { auditorId: { _eq: $userId } }
      order_by: { createdAt: desc }
      limit: $limit
      offset: $offset
    ) {
      id
      grade
      createdAt
      group {
        path
        members { user { login, firstName, lastName } }
      }
    }
    auditsReceived: audit(
      where: { group: { members: { userId: { _eq: $userId } } } }
      order_by: { createdAt: desc }
      limit: $limit
      offset: $offset
    ) {
      id
      grade
      createdAt
      auditor { login, firstName, lastName }
      group {
        path
      }
    }
    auditsGiven_aggregate: audit_aggregate(where: { auditorId: { _eq: $userId }, grade: { _is_null: false } }) {
      aggregate {
        count
      }
    }
    auditsReceived_aggregate: audit_aggregate(where: { group: { members: { userId: { _eq: $userId } } }, grade: { _is_null: false } }) {
      aggregate {
        count
      }
    }
  }
`,je=({user:s})=>{const[x,m]=u.useState(""),[c,o]=u.useState("all"),[i,h]=u.useState("all"),[d,w]=u.useState(50),[p,b]=u.useState(1);u.useEffect(()=>{b(1)},[x,c,i]);const{data:a,loading:g,error:N}=C(ce,{variables:{userId:s.id,limit:d,offset:(p-1)*d}}),{data:f,loading:M,error:T}=C(O,{variables:{id:s.id}}),{data:A,loading:U,error:D}=C(E`
    query GetAuditTransactions($userId: Int!) {
      transaction(
        where: {
          userId: { _eq: $userId }
          _or: [
            { type: { _eq: "up" } }
            { type: { _eq: "down" } }
          ]
          attrs: { _has_key: "auditId" }
        }
        order_by: { createdAt: desc }
      ) {
        id
        amount
        path
        createdAt
        type
        attrs
      }
    }
  `,{variables:{userId:s.id}}),G=u.useMemo(()=>!a||!A?[]:[...(a.auditsGiven||[]).map(r=>({...r,type:"given"})),...(a.auditsReceived||[]).map(r=>({...r,type:"received"}))].map(r=>{const n=A.transaction.find(j=>j.attrs&&j.attrs.auditId===r.id);return n?{...r,amount:n.amount,transactionType:n.type}:{...r,amount:void 0,transactionType:void 0}}),[a,A]);if(g||M||U)return e.jsx(X,{});if(N||T||D)return e.jsxs("div",{children:["Error loading data: ",N?.message||T?.message||D?.message]});const q=i==="all"?G.sort((t,r)=>new Date(r.createdAt).getTime()-new Date(t.createdAt).getTime()):G.filter(t=>t.type===i),_=i==="all"?(a?.auditsGiven_aggregate.aggregate.count||0)+(a?.auditsReceived_aggregate.aggregate.count||0):i==="given"?a?.auditsGiven_aggregate.aggregate.count||0:a?.auditsReceived_aggregate.aggregate.count||0,$=Math.ceil(_/d),F=t=>{if(!t)return"";const r=t.split("/");return r[r.length-1]||""},V=t=>{if(!t.auditor)return"";const{login:r,firstName:n,lastName:j}=t.auditor;return`${r} ${n||""} ${j||""}`.trim()},z=(t,r)=>{if(!r)return!0;const n=r.toLowerCase();return!!(F(t.group?.path||"").toLowerCase().includes(n)||(t.group?.path||"").toLowerCase().includes(n)||t.auditor&&V(t).toLowerCase().includes(n)||t.group?.members?.length&&t.group.members.length>0&&t.group.members.some(H=>{const{login:K,firstName:Q,lastName:W}=H.user;return`${K} ${Q||""} ${W||""}`.trim().toLowerCase().includes(n)}))},k=q.filter(t=>{const r=z(t,x);if(c==="all")return r;const n=t.grade!==null;return c==="completed"&&n||c==="pending"&&!n?r:!1});return e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-indigo-900/20 to-slate-900 h-full w-full relative",children:[e.jsxs("div",{className:"fixed inset-0 opacity-30 pointer-events-none z-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500/5 to-purple-500/5"}),e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 30px 30px, rgba(99, 102, 241, 0.1) 2px, transparent 0)",backgroundSize:"60px 60px"}})]}),e.jsx("div",{className:"relative z-10 h-full w-full overflow-y-auto",children:e.jsxs("div",{className:"relative space-y-8 p-6",children:[e.jsxs(l.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 rounded-full backdrop-blur-sm border border-white/10 mb-4",children:e.jsx(I,{className:"w-10 h-10 text-indigo-400"})}),e.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-white via-indigo-100 to-purple-100 bg-clip-text text-transparent",children:"Audits Dashboard"}),e.jsxs("p",{className:"text-xl text-white/70 max-w-2xl mx-auto",children:["Track your peer review journey with ",e.jsx("span",{className:"text-indigo-400 font-semibold",children:_})," completed audit evaluations"]})]}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:[e.jsx(v,{icon:R,title:"Total Up Points",value:P(f?.user_by_pk?.totalUp),color:"bg-gradient-to-r from-green-500/30 to-emerald-500/30",bgGradient:"bg-gradient-to-br from-green-900/20 to-emerald-900/20",subValue:"Positive feedback earned"}),e.jsx(v,{icon:S,title:"Total Down Points",value:P(f?.user_by_pk?.totalDown),color:"bg-gradient-to-r from-red-500/30 to-rose-500/30",bgGradient:"bg-gradient-to-br from-red-900/20 to-rose-900/20",subValue:"Areas for improvement"}),e.jsx(v,{icon:Y,title:"Audit Ratio",value:`${f?.user_by_pk?.auditRatio.toFixed(1)}`||"0.0",color:"bg-gradient-to-r from-blue-500/30 to-cyan-500/30",bgGradient:"bg-gradient-to-br from-blue-900/20 to-cyan-900/20",trend:f?.user_by_pk?.auditRatio>1?{value:Math.round((f?.user_by_pk?.auditRatio-1)*100),isPositive:!0}:void 0,subValue:f?.user_by_pk?.auditRatio>1?"Above average!":"Keep contributing"}),e.jsx(v,{icon:I,title:"Audits Given",value:`${a?.auditsGiven_aggregate.aggregate.count||0}`,color:"bg-gradient-to-r from-purple-500/30 to-violet-500/30",bgGradient:"bg-gradient-to-br from-purple-900/20 to-violet-900/20",subValue:"Reviews provided"}),e.jsx(v,{icon:y,title:"Audits Received",value:`${a?.auditsReceived_aggregate.aggregate.count||0}`,color:"bg-gradient-to-r from-yellow-500/30 to-amber-500/30",bgGradient:"bg-gradient-to-br from-yellow-900/20 to-amber-900/20",subValue:"Reviews received"}),e.jsx(v,{icon:L,title:"Total Audits",value:`${(a?.auditsGiven_aggregate.aggregate.count||0)+(a?.auditsReceived_aggregate.aggregate.count||0)}`,color:"bg-gradient-to-r from-indigo-500/30 to-purple-500/30",bgGradient:"bg-gradient-to-br from-indigo-900/20 to-purple-900/20",subValue:"Overall audit activity"})]}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},className:"flex justify-center",children:e.jsxs("div",{className:"bg-gradient-to-r from-white/10 to-white/5 backdrop-blur-xl border border-white/20 rounded-3xl p-2 shadow-2xl",children:[e.jsx(l.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>h("all"),className:`px-8 py-4 rounded-2xl font-bold transition-all duration-300 ${i==="all"?"bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg shadow-indigo-500/30":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{children:"All Audits"})]})}),e.jsx(l.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>h("given"),className:`px-8 py-4 rounded-2xl font-bold transition-all duration-300 ${i==="given"?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/30":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"Audits Given"})]})}),e.jsx(l.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>h("received"),className:`px-8 py-4 rounded-2xl font-bold transition-all duration-300 ${i==="received"?"bg-gradient-to-r from-rose-500 to-pink-500 text-white shadow-lg shadow-rose-500/30":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{children:"Audits Received"})]})})]})}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-white/50 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search by project, auditor, or members...",value:x,onChange:t=>m(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-4 h-4 text-white/70"}),e.jsxs("select",{value:c,onChange:t=>o(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})})]}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map((t,r)=>e.jsx(me,{audit:t,index:r},`${t.id}-${t.type}`))}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Items per page:"}),e.jsxs("select",{value:d,onChange:t=>{w(Number(t.target.value)),b(1)},className:"bg-white/10 border border-white/20 rounded-lg px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm",children:["Showing ",k.length," of ",_," audits (Page ",p," of ",$,")"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>b(t=>Math.max(t-1,1)),disabled:p===1,className:"p-2 bg-white/10 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/20 transition-colors",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>b(t=>Math.min(t+1,$)),disabled:p===$,className:"p-2 bg-white/10 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/20 transition-colors",children:e.jsx(se,{className:"w-4 h-4"})})]})]})]}),k.length===0&&!g&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[e.jsx(y,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx("h3",{className:"text-white/70 text-lg font-medium mb-2",children:"No audits found"}),e.jsx("p",{className:"text-white/50",children:"Try adjusting your search criteria or filters."})]})]})})]})},v=({icon:s,title:x,value:m,color:c,subValue:o,trend:i,bgGradient:h})=>e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:`${h||"bg-gradient-to-br from-slate-800/50 to-slate-900/50"} backdrop-blur-lg rounded-2xl p-6 border border-white/10 hover:border-white/20 transition-all duration-300 hover:transform hover:scale-105 shadow-lg hover:shadow-xl`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${c} backdrop-blur-sm`,children:e.jsx(s,{className:"w-8 h-8 text-white drop-shadow-lg"})}),i&&e.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-semibold ${i.isPositive?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:[i.isPositive?"↗":"↘"," ",Math.abs(i.value),"%"]})]}),e.jsx("h3",{className:"text-3xl font-bold text-white mb-2 tracking-tight",children:m}),e.jsx("p",{className:"text-white/70 text-sm font-medium",children:x}),o&&e.jsx("p",{className:"text-white/50 text-xs mt-2 bg-white/5 rounded-lg px-2 py-1",children:o})]}),me=({audit:s,index:x})=>{const[m,c]=u.useState(!1),o=s.grade!==null,i=o&&s.grade>=1,d=(()=>{if(o)return i?"Passed":"Failed";const a=14*24*60*60*1e3,g=new Date(s.createdAt);return new Date().getTime()-g.getTime()>a?"Re-Assigned":"Pending"})(),w=()=>{switch(d){case"Passed":return"text-green-400 bg-green-400/20";case"Failed":return"text-red-400 bg-red-400/20";case"Re-Assigned":return"text-blue-400 bg-blue-400/20";default:return"text-yellow-400 bg-yellow-400/20"}},p=a=>{if(!a)return"Unknown Project";const g=a.split("/");return g[g.length-1]||"Unknown Project"},b=()=>s.type==="given"?"Audited Members":"Auditor";return e.jsxs(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:x*.05},className:"bg-slate-800/50 backdrop-blur-lg rounded-xl p-6 border border-slate-700/50 hover:bg-slate-800/70 hover:border-slate-600/50 transition-all duration-300 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-500/20 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-5 h-5 text-primary-400"})}),e.jsx("div",{children:e.jsx("span",{className:"text-white font-semibold text-lg",children:p(s.group.path)})})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide ${w()}`,children:d})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:J(s.createdAt)}),e.jsx("div",{className:"text-slate-400 text-sm",children:"Date"})]})]}),o&&d!=="Re-Assigned"&&d!=="Pending"&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${s.type==="given"?"bg-green-400/20":"bg-red-400/20"}`,children:s.type==="given"?e.jsx(R,{className:"w-4 h-4 text-green-400"}):e.jsx(S,{className:"w-4 h-4 text-red-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:`text-white font-medium ${s.type==="given"?"text-green-400":"text-red-400"}`,children:[s.type==="given"?"+":"-",s.amount!==void 0?P(Math.abs(s.amount)):"0"]}),e.jsx("div",{className:"text-slate-400 text-sm",children:s.type==="given"?"Up Points":"Down Points"})]})]}),d!=="Re-Assigned"&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${w()}`,children:o?i?e.jsx(ie,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:o?Number(s.grade.toFixed(2))*100+"%":"Pending"}),e.jsx("div",{className:"text-slate-400 text-sm",children:"Grade"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-slate-700/50 cursor-pointer hover:bg-slate-700/30 rounded-lg p-3 transition-colors",onClick:()=>c(!m),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-500/20 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:b()}),e.jsx("div",{className:"text-slate-400 text-sm",children:m?"Click to hide":"Click to view"})]})]}),e.jsx("div",{className:"transition-transform duration-200",children:m?e.jsx(oe,{className:"w-5 h-5 text-slate-400"}):e.jsx(de,{className:"w-5 h-5 text-slate-400"})})]}),m&&e.jsx(l.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 bg-slate-900/50 rounded-lg p-4 border border-slate-700/30",children:e.jsxs("div",{className:"space-y-3",children:[s.type!=="given"&&s.auditor&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(I,{className:"w-5 h-5 text-primary-400"}),e.jsx("span",{className:"text-white font-semibold",children:"Auditor"})]}),e.jsx("div",{className:"flex items-center justify-between bg-slate-800/50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary-500/30 to-primary-600/30 rounded-full flex items-center justify-center border border-primary-500/20",children:e.jsx("span",{className:"text-primary-300 text-sm font-semibold",children:s.auditor.firstName?.[0]||s.auditor.login[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:s.auditor.login}),e.jsx("div",{className:"text-slate-400 text-sm",children:`${s.auditor.firstName} ${s.auditor.lastName}`})]})]})})]}),s.type!=="received"&&s.group?.members?.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(y,{className:"w-5 h-5 text-primary-400"}),e.jsx("span",{className:"text-white font-semibold",children:"Audited Members"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 custom-scrollbar",children:s.group?.members?.map(a=>e.jsx("div",{className:"flex items-center justify-between bg-slate-800/50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary-500/30 to-primary-600/30 rounded-full flex items-center justify-center border border-primary-500/20",children:e.jsx("span",{className:"text-primary-300 text-sm font-semibold",children:a.user.firstName?.[0]||a.user.login[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:a.user.login}),e.jsx("div",{className:"text-slate-400 text-sm",children:`${a.user.firstName} ${a.user.lastName}`})]})]})},a.user.login))})]})]})})]})};export{je as default};
