import{r as o,j as e,m as n}from"./animation-vendor-BWQ_wUI_.js";import{C as E}from"./Card-boLi8-L0.js";import{L as Y,A as G,b as W,f as H}from"./index-BujnE6GC.js";import{G as J}from"./allQueries-BNSsczk8.js";import{T as y,U as Q,u as q,o as T,r as K,X as Z,Y as ee,_ as te,$ as ae,A as se,a0 as re,a1 as le}from"./ui-vendor-bNeDgDN7.js";import{d as ie}from"./apollo-vendor-8AJvV5pX.js";import"./react-vendor-DJG_os-6.js";const ue=({user:u})=>{const[x,N]=o.useState("level"),[c,g]=o.useState("all"),[h,V]=o.useState(""),[v,B]=o.useState(1),[p,P]=o.useState("desc"),[f,_]=o.useState(100),{data:i,loading:L,error:M}=ie(J,{errorPolicy:"all",fetchPolicy:"cache-and-network"}),d=o.useMemo(()=>i?.bhModuleUsers?i.bhModuleUsers.map((t,a)=>{const s=t.user;if(!s)return null;let r="unknown";if(s.label_users&&s.label_users.length>0){const l=s.label_users.find(j=>j.label?.name?.toLowerCase().includes("cohort"));l&&(r=l.label.name)}return{id:s.id,login:s.login||"Unknown",firstName:s.firstName||"",lastName:s.lastName||"",profile:s.profile||"",attrs:s.attrs||{},auditRatio:s.auditRatio||0,totalUp:s.totalUp||0,totalDown:s.totalDown||0,level:t.level||0,totalXP:s.totalUp||0,cohort:r,eventPath:"/bahrain/bh-module",createdAt:s.createdAt||t.createdAt,rank:a+1}}).filter(Boolean):[],[i]),F=o.useMemo(()=>{const t=new Set(["all"]);return i?.allLabels&&i.allLabels.forEach(a=>{a.name?.toLowerCase().includes("cohort")&&t.add(a.name)}),d.forEach(a=>{a.cohort&&a.cohort!=="unknown"&&t.add(a.cohort)}),Array.from(t).sort()},[i,d]),m=o.useMemo(()=>{let t=[...d];return c!=="all"&&(t=t.filter(a=>a.cohort===c)),h&&(t=t.filter(a=>a.login.toLowerCase().includes(h.toLowerCase())||a.firstName?.toLowerCase().includes(h.toLowerCase())||a.lastName?.toLowerCase().includes(h.toLowerCase()))),v>1&&(t=t.filter(a=>(a.level||0)>=v)),t.sort((a,s)=>{let r,l;switch(x){case"level":r=a.level||0,l=s.level||0;break;case"audit":r=a.auditRatio||0,l=s.auditRatio||0;break;case"overall":const j=Math.max(...t.map(b=>b.level||0),1),U=Math.max(...t.map(b=>b.auditRatio||0),1),$=Math.max(...t.map(b=>b.totalUp||0),1);r=(a.level||0)/j*40+(a.auditRatio||0)/U*40+(a.totalUp||0)/$*20,l=(s.level||0)/j*40+(s.auditRatio||0)/U*40+(s.totalUp||0)/$*20;break;default:r=a.level||0,l=s.level||0}return p==="desc"?l-r:r-l}),t.map((a,s)=>({...a,rank:s+1}))},[d,c,h,v,x,p]),k=o.useMemo(()=>{const t=m.findIndex(a=>a.id===u.id);return t>=0?t+1:null},[m,u.id]),w=i?.bhModuleStats?.aggregate?.count||d.length,O=i?.bhModuleStats?.aggregate?.max?.level||Math.max(...d.map(t=>t.level||0),0),z=i?.bhModuleStats?.aggregate?.avg?.level||d.reduce((t,a)=>t+(a.level||0),0)/Math.max(w,1),D=d.reduce((t,a)=>t+(a.auditRatio||0),0)/Math.max(w,1),C=t=>t==="all"?"All Cohorts":t.charAt(0).toUpperCase()+t.slice(1),R=t=>{switch(t){case 1:return e.jsx(le,{className:"w-5 h-5 text-yellow-400"});case 2:return e.jsx(re,{className:"w-5 h-5 text-gray-300"});case 3:return e.jsx(se,{className:"w-5 h-5 text-amber-600"});default:return e.jsxs("span",{className:"text-white/60 font-bold",children:["#",t]})}},I=t=>{switch(t){case 1:return"bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 border-yellow-500/30";case 2:return"bg-gradient-to-r from-gray-400/20 to-gray-500/20 border-gray-400/30";case 3:return"bg-gradient-to-r from-amber-600/20 to-amber-700/20 border-amber-600/30";default:return"bg-white/5 border-white/10"}},S=()=>{const t=c!=="all"?` - ${C(c)}`:"";switch(x){case"level":return`BH Module - Level Rankings${t}`;case"audit":return`BH Module - Audit Ratio Rankings${t}`;case"overall":return`BH Module - Overall Rankings${t}`;default:return`BH Module Leaderboard${t}`}},X=t=>{switch(x){case"level":return{value:`Level ${t.level||0}`,subValue:`${H(t.totalUp||0)} XP`};case"audit":return{value:(t.auditRatio||0).toFixed(2),subValue:`${t.totalUp||0} ↑ ${t.totalDown||0} ↓`};case"overall":return{value:`L${t.level||0}`,subValue:`${H(t.totalUp||0)} • ${(t.auditRatio||0).toFixed(1)}`};default:return{value:`${t.level||0}`,subValue:""}}};return L&&!i?e.jsx(Y,{}):M?e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-400",children:[e.jsx("p",{children:"Error loading leaderboard data"}),e.jsx("p",{className:"text-sm text-white/60 mt-2",children:M?.message})]})}):e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-blue-900/20 to-slate-900 min-h-full relative",children:[e.jsxs("div",{className:"fixed inset-0 opacity-30 pointer-events-none z-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 to-purple-500/5"}),e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 40px 40px, rgba(59, 130, 246, 0.1) 2px, transparent 0)",backgroundSize:"80px 80px"}})]}),e.jsxs("div",{className:"relative z-10 space-y-8 p-6",children:[e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-full backdrop-blur-sm border border-white/10 mb-4",children:e.jsx(y,{className:"w-10 h-10 text-blue-400"})}),e.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-white via-blue-100 to-purple-100 bg-clip-text text-transparent",children:"BH Module Leaderboard"}),e.jsxs("p",{className:"text-xl text-white/70 max-w-2xl mx-auto",children:["Rankings for ",e.jsx("span",{className:"text-blue-400 font-semibold",children:w})," BH Module students"]})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(A,{icon:Q,title:"Total Students",value:w.toLocaleString(),color:"from-blue-500/30 to-cyan-500/30",subValue:"BH Module participants"}),e.jsx(A,{icon:q,title:"Average Level",value:z.toFixed(1),color:"from-green-500/30 to-emerald-500/30",subValue:`Max: ${O}`}),e.jsx(A,{icon:T,title:"Avg Audit Ratio",value:D.toFixed(2),color:"from-orange-500/30 to-red-500/30",subValue:"Community contribution"})]}),e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"flex flex-wrap gap-2 justify-center",children:[{key:"level",label:"📊 Level Rankings",icon:K},{key:"audit",label:"⚖️ Audit Rankings",icon:T},{key:"overall",label:"🏆 Overall Rankings",icon:y}].map(({key:t,label:a,icon:s})=>e.jsxs("button",{onClick:()=>N(t),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ${x===t?"bg-primary-500 text-white shadow-lg":"bg-white/10 text-white/70 hover:bg-white/20 hover:text-white"}`,children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:a})]},t))}),e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-white/50 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search users by login, name...",value:h,onChange:t=>V(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("select",{value:c,onChange:t=>g(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:F.map(t=>e.jsx("option",{value:t,children:C(t)},t))}),e.jsxs("select",{value:v,onChange:t=>B(Number(t.target.value)),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:1,children:"All Levels"}),e.jsx("option",{value:5,children:"Level 5+"}),e.jsx("option",{value:10,children:"Level 10+"}),e.jsx("option",{value:15,children:"Level 15+"}),e.jsx("option",{value:20,children:"Level 20+"}),e.jsx("option",{value:25,children:"Level 25+"})]}),e.jsxs("button",{onClick:()=>P(p==="desc"?"asc":"desc"),className:"flex items-center space-x-2 px-3 py-2 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white transition-all",children:[p==="desc"?e.jsx(ee,{className:"w-4 h-4"}):e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:p==="desc"?"High to Low":"Low to High"})]})]})]})}),k&&e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:e.jsx(E,{className:"p-4 bg-gradient-to-r from-primary-500/10 to-primary-600/10 border border-primary-500/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[R(k),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Your Current Position"}),e.jsx("p",{className:"text-white/60 text-sm",children:S()})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:["#",k]}),e.jsxs("p",{className:"text-white/60 text-sm",children:["of ",m.length]})]})]})})}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center",children:[e.jsx(y,{className:"w-5 h-5 mr-2 text-primary-400"}),S(),e.jsxs("span",{className:"ml-2 text-primary-400",children:["(",m.length,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Show:"}),e.jsxs("select",{value:f,onChange:t=>_(Number(t.target.value)),className:"bg-white/10 border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-primary-500",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:200,children:"200"}),e.jsx("option",{value:500,children:"500"})]})]})]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[m.slice(0,f).map((t,a)=>{const s=t.rank||a+1,r=t.id===u.id,l=X(t);return e.jsxs(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.02},className:`flex items-center justify-between p-3 rounded-lg border transition-all ${r?"bg-primary-500/20 border-primary-500/30 ring-1 ring-primary-500/20":I(s)}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:R(s)}),e.jsx(G,{user:t,size:"sm",className:"w-8 h-8"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-white font-medium",children:t.login}),r&&e.jsx("span",{className:"px-2 py-1 bg-primary-500/20 text-primary-400 rounded text-xs font-medium",children:"You"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-white/60",children:[e.jsxs("span",{children:[t.firstName," ",t.lastName]}),t.cohort!=="unknown"&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),C(t.cohort)]}),e.jsxs("span",{children:["Joined ",W(t.createdAt)]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-white",children:l.value}),e.jsx("div",{className:"text-xs text-white/60",children:l.subValue})]})]},t.id)}),m.length>f&&e.jsx("div",{className:"text-center py-4",children:e.jsxs("p",{className:"text-white/60 text-sm",children:["Showing ",f," of ",m.length," users"]})})]})]}),L&&e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"}),e.jsx("span",{className:"ml-3 text-white/70",children:"Loading BH Module leaderboard data..."})]})}),m.length===0&&!L&&e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[e.jsx(y,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx("h3",{className:"text-white/70 text-lg font-medium mb-2",children:"No users found"}),e.jsx("p",{className:"text-white/50",children:"Try adjusting your search criteria or filters."})]})]})]})},A=({icon:u,title:x,value:N,color:c,subValue:g})=>e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:`bg-gradient-to-br ${c} backdrop-blur-lg rounded-2xl p-6 border border-white/10 hover:border-white/20 transition-all duration-300 hover:transform hover:scale-105 shadow-lg hover:shadow-xl`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-3 rounded-xl bg-white/20 backdrop-blur-sm",children:e.jsx(u,{className:"w-8 h-8 text-white drop-shadow-lg"})})}),e.jsx("h3",{className:"text-3xl font-bold text-white mb-2 tracking-tight",children:N}),e.jsx("p",{className:"text-white/70 text-sm font-medium",children:x}),g&&e.jsx("p",{className:"text-white/50 text-xs mt-2 bg-white/5 rounded-lg px-2 py-1",children:g})]});export{ue as default};
