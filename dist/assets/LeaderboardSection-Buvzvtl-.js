import{r as h,R as me,j as e,m as x}from"./animation-vendor-w_1g82yL.js";import{C as J}from"./Card-ErpTf4ug.js";import{L as he,A as ue,b as xe}from"./index-CQX0gRRp.js";import{G as be,a as pe,b as fe}from"./allQueries-C1LmK1xE.js";import{T as F,U as Q,v as ge,p as D,s as ve,X as Ne,Y as we,_ as ye,A as je,$ as Le,a0 as Ce}from"./ui-vendor-CAUkr1F8.js";import{d as z}from"./apollo-vendor-8AJvV5pX.js";import"./react-vendor-DJG_os-6.js";const Ie=({user:j})=>{const[m,I]=h.useState("level"),[p,A]=h.useState("all"),[N,K]=h.useState(""),[S,Z]=h.useState(""),[k,ee]=h.useState(1),[b,te]=h.useState("desc"),[R,ae]=h.useState(100),{data:d,loading:H}=z(be,{errorPolicy:"all",fetchPolicy:"cache-and-network"}),{data:L,loading:$}=z(pe,{errorPolicy:"all",fetchPolicy:"cache-and-network"}),{data:w,loading:O}=z(fe,{errorPolicy:"all",fetchPolicy:"cache-and-network"}),P=h.useMemo(()=>(w?.label||[]).filter(s=>s.name.toLowerCase().includes("cohort")).map(s=>{const r=s.name.toLowerCase();let l=s.name;return r.includes("cohort4")||r.includes("cohort-4")?l="Cohort 4":r.includes("cohort1")?l="Cohort 1":r.includes("cohort2")?l="Cohort 2":r.includes("cohort3")&&(l="Cohort 3"),{id:s.id,name:l,description:s.description||""}}).filter((s,r,l)=>l.findIndex(o=>o.name===s.name)===r),[w?.label]),q=h.useMemo(()=>{const t=new Map;return w?.label&&w.label.forEach(i=>{const a=i.name.toLowerCase(),s=i.description||"";if(!a.includes("cohort"))return;const r=[/module #(\d+)/i,/event #(\d+)/i,/event (\d+)/i,/#(\d+)/i,/id:?\s*(\d+)/i];let l=null;for(const o of r){const c=s.match(o);if(c){l=parseInt(c[1],10);break}}if(l){let o=i.name;a.includes("cohort4")||a.includes("cohort-4")?o="Cohort 4":a.includes("cohort1")?o="Cohort 1":a.includes("cohort2")?o="Cohort 2":a.includes("cohort3")&&(o="Cohort 3"),t.set(l,o)}}),t.size===0,t},[w?.label]),B=h.useMemo(()=>{const t=new Map,i=L?.label_user||[],a=d?.userLabels||[];return[...i,...a].forEach(l=>{if(l.label?.name?.toLowerCase().includes("cohort")){const o=l.userId;t.has(o)||t.set(o,[]);const c=l.label,n=c.name.toLowerCase();let f=c.name;n.includes("cohort4")||n.includes("cohort-4")?f="Cohort 4":n.includes("cohort1")?f="Cohort 1":n.includes("cohort2")?f="Cohort 2":n.includes("cohort3")&&(f="Cohort 3");const g={...l,label:{...c,name:f}};t.get(o).push(g)}}),(d?.allEventUsers||[]).forEach(l=>{const o=l.userId,c=l.eventId,n=q.get(c);if(n&&o&&(t.has(o)||t.set(o,[]),!(t.get(o)||[]).some(v=>v.label.name===n))){const v={id:c*1e6+o,userId:o,labelId:c,label:{id:c,name:n,description:`Cohort based on Event ${c} participation`}};t.get(o).push(v)}}),t.forEach((l,o)=>{const c=new Set,n=l.filter(f=>{const g=f.label.name;return c.has(g)?!1:(c.add(g),!0)});t.set(o,n)}),t},[L?.label_user,d?.userLabels,d?.allEventUsers,q]);me.useEffect(()=>{},[H,d,$,L,O,w]);const U=H||$||O,se=!d&&!U,u=h.useMemo(()=>{if(!d?.bhModuleUsers)return[];const t=new Map,i=new Map;return d.allUsersWithEvents&&d.allUsersWithEvents.forEach(a=>{t.set(a.id,a)}),d.publicUsers&&d.publicUsers.forEach(a=>{i.set(a.id,a)}),d.bhModuleUsers.map((a,s)=>{const r=a.userId,l=a.userLogin,o=a.userName,c=Number(a.userAuditRatio)||0;if(!r)return null;let n=t.get(r);n||(n=i.get(r));const g=(B.get(r)||[]).filter(y=>y.label?.name?.toLowerCase().includes("cohort")),v=g.map(y=>y.label.name);let M="No Cohort";v.length>0&&(M=v[0]);const Y=g;if(!n){const y=o?o.split(" "):[];return{id:r,login:l||`user_${r}`,firstName:y[0]||"",lastName:y.slice(1).join(" ")||"",profile:"",attrs:{},auditRatio:c,totalUp:0,totalDown:0,level:a.level||0,totalXP:0,cohort:M,eventPath:"/bahrain/bh-module",createdAt:a.createdAt,rank:s+1,userLabels:Y,labelNames:v}}return{id:r,login:n.login||l||`user_${r}`,firstName:n.firstName||"",lastName:n.lastName||"",profile:n.profile||"",attrs:n.attrs||{},auditRatio:c,totalUp:n.totalUp||0,totalDown:n.totalDown||0,level:a.level||0,totalXP:n.totalUp||0,cohort:M,eventPath:"/bahrain/bh-module",createdAt:n.createdAt||a.createdAt,rank:s+1,userLabels:Y,labelNames:v}}).filter(Boolean)},[d,B]),le=h.useMemo(()=>{const t=new Set(["all"]);return u.forEach(a=>{a.labelNames&&a.labelNames.length>0&&a.labelNames.forEach(s=>{t.add(s)}),a.cohort&&a.cohort!=="No Cohort"&&t.add(a.cohort)}),Array.from(t).sort()},[u]),E=h.useMemo(()=>{let t=[...u];return p!=="all"&&(t=t.filter(i=>i.labelNames?.includes(p)||i.cohort===p)),N&&(t=t.filter(i=>i.login.toLowerCase().includes(N.toLowerCase())||i.firstName?.toLowerCase().includes(N.toLowerCase())||i.lastName?.toLowerCase().includes(N.toLowerCase()))),S&&(t=t.filter(i=>(i.userLabels?.filter(s=>s.label.name.toLowerCase().includes("cohort"))||[]).some(s=>s.label.name.toLowerCase().includes(S.toLowerCase()))||i.cohort?.toLowerCase().includes(S.toLowerCase()))),k>1&&(t=t.filter(i=>(i.level||0)>=k)),t.sort((i,a)=>{let s,r;switch(m){case"level":s=i.level||0,r=a.level||0;break;case"audit":s=Number(i.auditRatio)||0,r=Number(a.auditRatio)||0;break;default:s=i.level||0,r=a.level||0}return b==="desc"?r-s:s-r}),t},[u,p,N,S,k,m,b]),T=h.useMemo(()=>{const i=[...u].sort((a,s)=>{let r,l;switch(m){case"level":r=a.level||0,l=s.level||0;break;case"audit":r=Number(a.auditRatio)||0,l=Number(s.auditRatio)||0;break;default:r=a.level||0,l=s.level||0}m==="audit"&&(isFinite(r)||(r=0),isFinite(l)||(l=0));const o=b==="desc"?l-r:r-l;if(o!==0)return o;if(m==="audit"){const c=b==="desc"?(s.level||0)-(a.level||0):(a.level||0)-(s.level||0);if(c!==0)return c}return a.login.localeCompare(s.login)}).findIndex(a=>a.id===j.id);return i>=0?i+1:null},[u,j.id,m,b]),re=h.useCallback(t=>{const a=[...u].sort((s,r)=>{let l,o;switch(m){case"level":l=s.level||0,o=r.level||0;break;case"audit":l=Number(s.auditRatio)||0,o=Number(r.auditRatio)||0;break;default:l=s.level||0,o=r.level||0}m==="audit"&&(isFinite(l)||(l=0),isFinite(o)||(o=0));const c=b==="desc"?o-l:l-o;if(c!==0)return c;if(m==="audit"){const n=b==="desc"?(r.level||0)-(s.level||0):(s.level||0)-(r.level||0);if(n!==0)return n}return s.login.localeCompare(r.login)}).findIndex(s=>s.id===t);return a>=0?a+1:null},[u,m,b]),C=d?.bhModuleStats?.aggregate?.count||u.length,ie=d?.bhModuleStats?.aggregate?.max?.level||Math.max(...u.map(t=>t.level||0),0),oe=d?.bhModuleStats?.aggregate?.avg?.level||u.reduce((t,i)=>t+(i.level||0),0)/Math.max(C,1),_=u.map(t=>Number(t.auditRatio)||0).filter(t=>isFinite(t)&&t>0),ne=_.length>0?_.reduce((t,i)=>t+i,0)/_.length:0,G=t=>t==="all"?"All Cohorts":t.charAt(0).toUpperCase()+t.slice(1),W=t=>{switch(t){case 1:return e.jsx(Ce,{className:"w-5 h-5 text-yellow-400"});case 2:return e.jsx(Le,{className:"w-5 h-5 text-gray-300"});case 3:return e.jsx(je,{className:"w-5 h-5 text-amber-600"});default:return e.jsxs("span",{className:"text-white/60 font-bold",children:["#",t]})}},ce=t=>{switch(t){case 1:return"bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 border-yellow-500/30";case 2:return"bg-gradient-to-r from-gray-400/20 to-gray-500/20 border-gray-400/30";case 3:return"bg-gradient-to-r from-amber-600/20 to-amber-700/20 border-amber-600/30";default:return"bg-white/5 border-white/10"}},X=()=>{const t=p!=="all"?` - ${G(p)}`:"";switch(m){case"level":return`Level Rankings${t}`;case"audit":return`Audit Ratio Rankings${t}`;default:return`Leaderboard${t}`}},de=t=>{switch(m){case"level":return{value:`Level ${t.level||0}`,subValue:""};case"audit":return{value:(Number(t.auditRatio)||0).toFixed(1),subValue:""};default:return{value:`${t.level||0}`,subValue:""}}};return U?e.jsx(he,{}):se?e.jsx(J,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-400",children:[e.jsx("p",{children:"Error loading leaderboard data"}),e.jsx("p",{className:"text-sm text-white/60 mt-2",children:"Unable to load required data"})]})}):e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-blue-900/20 to-slate-900 h-full w-full relative",children:[e.jsxs("div",{className:"fixed inset-0 opacity-30 pointer-events-none z-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 to-purple-500/5"}),e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 40px 40px, rgba(59, 130, 246, 0.1) 2px, transparent 0)",backgroundSize:"80px 80px"}})]}),e.jsxs("div",{className:"relative z-10 h-full w-full overflow-y-auto space-y-8 p-6",children:[(L?.label_user?.length||0)<=1&&!$&&e.jsx(x.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-amber-500/10 border border-amber-500/20 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-amber-200 text-sm font-medium",children:"Label Access Limited"}),e.jsxs("p",{className:"text-amber-100/70 text-xs mt-1",children:["Only ",L?.label_user?.length||0,' label assignment(s) accessible. Users may show "No labels" due to database permissions.']})]})]})}),e.jsxs(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-full backdrop-blur-sm border border-white/10 mb-4",children:e.jsx(F,{className:"w-10 h-10 text-blue-400"})}),e.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-white via-blue-100 to-purple-100 bg-clip-text text-transparent",children:"Leaderboard Dashboard"}),e.jsxs("p",{className:"text-xl text-white/70 max-w-2xl mx-auto",children:["Rankings for ",e.jsx("span",{className:"text-blue-400 font-semibold",children:C})," Students"]})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(V,{icon:Q,title:"Total Students",value:C.toLocaleString(),color:"from-blue-500/30 to-cyan-500/30",subValue:"Participants"}),e.jsx(V,{icon:ge,title:"Average Level",value:oe.toFixed(1),color:"from-green-500/30 to-emerald-500/30",subValue:`Max: ${ie}`}),e.jsx(V,{icon:D,title:"Avg Audit Ratio",value:ne.toFixed(2),color:"from-orange-500/30 to-red-500/30",subValue:"Community contribution"})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.15},className:"bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:e.jsx(Q,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Available Cohort Labels"}),e.jsx("p",{className:"text-sm text-white/60",children:"Dynamic cohort detection from database"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.length>0?P.map((t,i)=>e.jsx(x.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:i*.05},className:"px-3 py-1.5 bg-cyan-500/20 text-cyan-300 rounded-lg text-sm font-medium border border-cyan-500/30 hover:bg-cyan-500/30 transition-colors cursor-pointer",title:t.description,onClick:()=>Z(t.name),children:t.name},t.id)):e.jsxs("div",{className:"flex items-center space-x-2 text-amber-400",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm",children:"No cohort labels detected or limited database access"})]})}),P.length>0&&e.jsx("p",{className:"text-xs text-white/50 mt-3",children:"💡 Click on a cohort label to search for users with that label"})]}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"flex flex-wrap gap-2 justify-center",children:[{key:"level",label:"📊 Level Rankings",icon:ve},{key:"audit",label:"⚖️ Audit Rankings",icon:D}].map(({key:t,label:i,icon:a})=>e.jsxs("button",{onClick:()=>I(t),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ${m===t?"bg-primary-500 text-white shadow-lg":"bg-white/10 text-white/70 hover:bg-white/20 hover:text-white"}`,children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:i})]},t))}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-white/50 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search by username, full name",value:N,onChange:t=>K(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("select",{value:p,onChange:t=>A(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:le.map(t=>e.jsx("option",{value:t,children:G(t)},t))}),e.jsxs("select",{value:k,onChange:t=>ee(Number(t.target.value)),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:1,children:"All Levels"}),e.jsx("option",{value:5,children:"Level 5+"}),e.jsx("option",{value:10,children:"Level 10+"}),e.jsx("option",{value:20,children:"Level 20+"}),e.jsx("option",{value:40,children:"Level 40+"}),e.jsx("option",{value:80,children:"Level 80+"}),e.jsx("option",{value:100,children:"Level 100+"})]}),e.jsxs("button",{onClick:()=>te(b==="desc"?"asc":"desc"),className:"flex items-center space-x-2 px-3 py-2 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white transition-all",children:[b==="desc"?e.jsx(we,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:b==="desc"?"High to Low":"Low to High"})]})]})]})}),T&&e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:e.jsx(J,{className:"p-4 bg-gradient-to-r from-primary-500/10 to-primary-600/10 border border-primary-500/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[W(T),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Your Current Position"}),e.jsx("p",{className:"text-white/60 text-sm",children:X()})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:["#",T]}),e.jsxs("p",{className:"text-white/60 text-sm",children:["of ",C]})]})]})})}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center",children:[e.jsx(F,{className:"w-5 h-5 mr-2 text-primary-400"}),X(),e.jsxs("span",{className:"ml-2 text-primary-400",children:["(",E.length,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Show:"}),e.jsxs("select",{value:R,onChange:t=>ae(Number(t.target.value)),className:"bg-white/10 border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-primary-500",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:200,children:"200"}),e.jsx("option",{value:500,children:"500"})]})]})]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[E.slice(0,R).map((t,i)=>{const a=re(t.id)||i+1,s=t.id===j.id,r=de(t);return e.jsxs(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.02},className:`flex items-center justify-between p-3 rounded-lg border transition-all ${s?"bg-primary-500/20 border-primary-500/30 ring-1 ring-primary-500/20":ce(a)}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:W(a)}),e.jsx(ue,{user:t,size:"sm",className:"w-8 h-8"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-white font-medium",children:t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:t.login}),t.firstName&&t.lastName&&e.jsxs("span",{className:"text-xs text-white/60",children:["@",t.login]})]}),s&&e.jsx("span",{className:"px-2 py-1 bg-primary-500/20 text-primary-400 rounded text-xs font-medium",children:"You"})]}),null,e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-white/60 mt-1",children:[t.userLabels&&t.userLabels.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.userLabels.map((l,o)=>e.jsxs("span",{className:"px-1.5 py-0.5 bg-cyan-400/20 text-cyan-400 rounded text-xs font-medium border border-cyan-400/30",title:`Cohort Label: ${l.label.name}`,children:["🏷️ ",l.label.name]},l.id||o))}),(!t.userLabels||t.userLabels.length===0)&&e.jsx("span",{className:"text-amber-400 text-xs",children:"No cohort labels"}),e.jsxs("span",{className:"ml-auto",children:["Joined ",xe(t.createdAt)]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-white",children:r.value}),e.jsx("div",{className:"text-xs text-white/60",children:r.subValue})]})]},t.id)}),E.length>R&&e.jsx("div",{className:"text-center py-4",children:e.jsxs("p",{className:"text-white/60 text-sm",children:["Showing ",R," of ",C," users"]})})]})]}),U&&e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"}),e.jsx("span",{className:"ml-3 text-white/70",children:"Loading leaderboard data..."})]})}),E.length===0&&!U&&e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[e.jsx(F,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx("h3",{className:"text-white/70 text-lg font-medium mb-2",children:"No users found"}),e.jsx("p",{className:"text-white/50",children:"Try adjusting your search criteria or filters."})]})]})]})},V=({icon:j,title:m,value:I,color:p,subValue:A})=>e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:`bg-gradient-to-br ${p} backdrop-blur-lg rounded-2xl p-6 border border-white/10 hover:border-white/20 transition-all duration-300 hover:transform hover:scale-105 shadow-lg hover:shadow-xl`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-3 rounded-xl bg-white/20 backdrop-blur-sm",children:e.jsx(j,{className:"w-8 h-8 text-white drop-shadow-lg"})})}),e.jsx("h3",{className:"text-3xl font-bold text-white mb-2 tracking-tight",children:I}),e.jsx("p",{className:"text-white/70 text-sm font-medium",children:m}),A&&e.jsx("p",{className:"text-white/50 text-xs mt-2 bg-white/5 rounded-lg px-2 py-1",children:A})]});export{Ie as default};
