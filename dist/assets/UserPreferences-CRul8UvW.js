import{r as w,j as e,m,A as I}from"./animation-vendor-BWQ_wUI_.js";import{C as F}from"./Card-boLi8-L0.js";import{R as H,b as M}from"./index-C4FaYD6o.js";import{a8 as P,a9 as D,Z as U,R as $,S as E,N as L,v as _,t as z,d as q,K as G,w as J,aa as V,ab as B,ac as Z,ad as W,z as X,y as K,a2 as Q,ae as Y}from"./ui-vendor-D_fcl71Q.js";import{d as ee,e as se}from"./apollo-vendor-8AJvV5pX.js";import"./react-vendor-DJG_os-6.js";const te=()=>{const n=w.useContext(H);if(n===void 0)throw new Error("useRefresh must be used within a RefreshProvider");return n},ae=({className:n="",showStats:b=!0,showAutoRefreshToggle:j=!0,compact:d=!1})=>{const{isGlobalRefreshing:a,refreshStats:h,refreshAll:o,hardRefresh:t,enableAutoRefresh:g,disableAutoRefresh:p,isAutoRefreshEnabled:u,autoRefreshInterval:f,clearCache:k,getCacheSize:T,isOnline:x,lastOnlineTime:R}=te(),[N,S]=w.useState(!1),[v,O]=w.useState(Math.round(f/1e3)),s=()=>{u?p():g(v*1e3)},r=c=>{O(c),u&&g(c*1e3)},l=c=>c<1e3?`${c}ms`:c<6e4?`${(c/1e3).toFixed(1)}s`:`${(c/6e4).toFixed(1)}m`,i=c=>{const y=Math.round(c/1e3);if(y<60)return`${y}s`;const C=Math.round(y/60);return C<60?`${C}m`:`${Math.round(C/60)}h`};return d?e.jsxs("div",{className:`flex items-center space-x-2 ${n}`,children:[e.jsx("div",{className:"flex items-center",children:x?e.jsx(P,{className:"w-4 h-4 text-green-400"}):e.jsx(D,{className:"w-4 h-4 text-red-400"})}),u&&e.jsxs("div",{className:"flex items-center text-xs text-primary-400",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),i(f)]}),e.jsx(m.button,{onClick:o,disabled:a,whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-2 rounded-lg transition-all ${a?"bg-primary-500/20 text-primary-400 cursor-wait":"bg-white/10 text-white/70 hover:bg-white/20 hover:text-white"}`,children:e.jsx($,{className:`w-4 h-4 ${a?"animate-spin":""}`})})]}):e.jsxs("div",{className:`bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-white/20 ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary-500/20",children:e.jsx($,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-medium",children:"Data Refresh"}),e.jsxs("p",{className:"text-white/60 text-sm",children:[x?"Online":"Offline"," •",u?` Auto: ${i(f)}`:" Manual"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${x?"bg-green-500/20":"bg-red-500/20"}`,children:x?e.jsx(P,{className:"w-4 h-4 text-green-400"}):e.jsx(D,{className:"w-4 h-4 text-red-400"})}),e.jsx(m.button,{onClick:()=>S(!N),whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-2 rounded-lg transition-all ${N?"bg-primary-500/20 text-primary-400":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:e.jsx(E,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs(m.button,{onClick:o,disabled:a,whileHover:{scale:1.02},whileTap:{scale:.98},className:`p-3 rounded-lg border transition-all text-left ${a?"bg-primary-500/20 border-primary-500/30 text-primary-400 cursor-wait":"bg-white/5 border-white/10 text-white hover:bg-white/10"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx($,{className:`w-4 h-4 ${a?"animate-spin":""}`}),e.jsx("span",{className:"font-medium",children:"Refresh All"})]}),e.jsx("p",{className:"text-xs text-white/60",children:a?"Refreshing...":"Update all data"})]}),e.jsxs(m.button,{onClick:t,disabled:a,whileHover:{scale:1.02},whileTap:{scale:.98},className:"p-3 rounded-lg border bg-white/5 border-white/10 text-white hover:bg-white/10 transition-all text-left disabled:opacity-50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Hard Refresh"})]}),e.jsx("p",{className:"text-xs text-white/60",children:"Clear cache & refresh"})]}),j&&e.jsxs(m.button,{onClick:s,whileHover:{scale:1.02},whileTap:{scale:.98},className:`p-3 rounded-lg border transition-all text-left ${u?"bg-green-500/20 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-white hover:bg-white/10"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Auto Refresh"})]}),e.jsx("p",{className:"text-xs text-white/60",children:u?`Every ${i(f)}`:"Disabled"})]})]}),e.jsx(I,{children:N&&e.jsxs(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t border-white/10 pt-4",children:[e.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Refresh Settings"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-white/80 text-sm mb-2",children:"Auto-refresh Interval"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:v,onChange:c=>r(Number(c.target.value)),className:"flex-1 h-2 bg-white/20 rounded-lg appearance-none cursor-pointer"}),e.jsxs("span",{className:"text-white/70 text-sm w-12",children:[v,"s"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm",children:"Cache Size"}),e.jsxs("p",{className:"text-white/60 text-xs",children:[T()," entries"]})]}),e.jsx(m.button,{onClick:k,whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-lg text-sm hover:bg-red-500/30 transition-all",children:"Clear Cache"})]})]})}),b&&e.jsxs("div",{className:"border-t border-white/10 pt-4 mt-4",children:[e.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Refresh Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-1",children:e.jsx(z,{className:"w-4 h-4 text-blue-400"})}),e.jsx("p",{className:"text-lg font-bold text-white",children:h.totalRefreshes}),e.jsx("p",{className:"text-xs text-white/60",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-1",children:e.jsx(q,{className:"w-4 h-4 text-green-400"})}),e.jsx("p",{className:"text-lg font-bold text-white",children:h.successfulRefreshes}),e.jsx("p",{className:"text-xs text-white/60",children:"Success"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-1",children:e.jsx(G,{className:"w-4 h-4 text-red-400"})}),e.jsx("p",{className:"text-lg font-bold text-white",children:h.failedRefreshes}),e.jsx("p",{className:"text-xs text-white/60",children:"Failed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-1",children:e.jsx(J,{className:"w-4 h-4 text-purple-400"})}),e.jsx("p",{className:"text-lg font-bold text-white",children:l(h.averageRefreshTime)}),e.jsx("p",{className:"text-xs text-white/60",children:"Avg Time"})]})]}),h.lastRefreshTime&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("p",{className:"text-white/60 text-xs",children:["Last refresh: ",M(h.lastRefreshTime)]})}),!x&&R&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("p",{className:"text-red-400 text-xs flex items-center justify-center",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Last online: ",M(R)]})})]})]})},re=n=>{const b={exportDate:new Date().toISOString(),totalProjects:n.length,projects:n},j=new Blob([JSON.stringify(b,null,2)],{type:"application/json"}),d=URL.createObjectURL(j),a=document.createElement("a");a.href=d,a.download=`subjects-projects-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(d)},ie=n=>{const b=["ID","Name","Language","Difficulty","Type","Expected Files","Allowed Functions","Validations Count","Created At","Path","Group Min","Group Max","Required Audit Ratio"],j=n.map(t=>[t.id,t.name,t.language,t.difficulty,t.type,t.expectedFiles.join(";"),t.allowedFunctions.join(";"),t.validations.length,t.createdAt,t.path,t.groupMin||"",t.groupMax||"",t.requiredAuditRatio||""]),d=[b,...j].map(t=>t.map(g=>`"${g}"`).join(",")).join(`
`),a=new Blob([d],{type:"text/csv"}),h=URL.createObjectURL(a),o=document.createElement("a");o.href=h,o.download=`subjects-projects-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(h)},le=se`
  query GetSubjectsForExport {
    object(
      where: {
        _and: [
          { campus: { _eq: "bahrain" } },
          { type: { _in: ["exercise", "project"] } },
          { name: { _is_null: false } }
        ]
      }
      order_by: [
        { type: asc },
        { name: asc }
      ]
    ) {
      id
      name
      type
      attrs
      campus
      createdAt
      updatedAt
      events {
        id
        path
        createdAt
        endAt
      }
    }
  }
`,A={theme:"dark",dashboard:{compactMode:!1,showAnimations:!0,defaultTab:"dashboard",chartsEnabled:!0,tabOrder:["dashboard","piscines","leaderboard","groups","audits","checkpoints","events","export"]}},pe=({userId:n,onClose:b,defaultTabs:j=[]})=>{const[d,a]=w.useState(A),[h,o]=w.useState(!1),[t,g]=w.useState("appearance"),{data:p,loading:u}=ee(le);w.useEffect(()=>{const s=localStorage.getItem(`user-preferences-${n}`);if(s)try{const r=JSON.parse(s);a({...A,...r})}catch(r){console.error("Failed to parse preferences:",r)}},[n]);const f=()=>p?.object?p.object.map(s=>({id:s.id,name:s.name,language:s.attrs?.language||"Unknown",difficulty:"Intermediate",type:s.type,expectedFiles:s.attrs?.expectedFiles||[],allowedFunctions:s.attrs?.allowedFunctions||[],validations:s.attrs?.validations||[],createdAt:s.createdAt,path:s.events?.[0]?.path||"",groupMin:s.attrs?.groupMin,groupMax:s.attrs?.groupMax,requiredAuditRatio:s.attrs?.requiredAuditRatio})):[],k=()=>{const s=f();re(s)},T=()=>{const s=f();ie(s)},x=(s,r,l)=>{a(i=>({...i,[s]:{...i[s],[r]:l}})),o(!0)},R=()=>{localStorage.setItem(`user-preferences-${n}`,JSON.stringify(d)),o(!1),console.log("Preferences saved:",d)},N=()=>{a(A),o(!0)},S=(s,r)=>{const l=[...d.dashboard.tabOrder],[i]=l.splice(s,1);l.splice(r,0,i),x("dashboard","tabOrder",l)},v=()=>{x("dashboard","tabOrder",A.dashboard.tabOrder)},O=[{id:"appearance",label:"Appearance",icon:B},{id:"dashboard",label:"Dashboard",icon:E},{id:"data",label:"Data Management",icon:L}];return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(m.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"User Preferences"}),e.jsx("p",{className:"text-white/60 mt-1",children:"Customize your dashboard experience"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[h&&e.jsxs(m.button,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onClick:R,className:"flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Save Changes"]}),e.jsx("button",{onClick:b,className:"text-white/60 hover:text-white transition-colors",children:"✕"})]})]})}),e.jsxs("div",{className:"flex h-[600px]",children:[e.jsxs("div",{className:"w-64 bg-gray-900/50 border-r border-gray-700 p-4",children:[e.jsx("nav",{className:"space-y-2",children:O.map(s=>{const r=s.icon,l=t===s.id;return e.jsxs("button",{onClick:()=>g(s.id),className:`w-full flex items-center px-3 py-2 rounded-lg text-left transition-colors ${l?"bg-primary-600 text-white":"text-white/70 hover:text-white hover:bg-white/10"}`,children:[e.jsx(r,{className:"w-5 h-5 mr-3"}),s.label]},s.id)})}),e.jsx("div",{className:"mt-8 pt-4 border-t border-gray-700",children:e.jsxs("button",{onClick:N,className:"w-full flex items-center px-3 py-2 text-white/60 hover:text-white transition-colors",children:[e.jsx(Z,{className:"w-4 h-4 mr-3"}),"Reset to Defaults"]})})]}),e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[t==="appearance"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Appearance Settings"}),e.jsxs(F,{className:"p-4",children:[e.jsx("label",{className:"block text-white font-medium mb-3",children:"Theme"}),e.jsx("div",{className:"space-y-2",children:["dark","light","auto"].map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"theme",value:s,checked:d.theme===s,onChange:r=>x("theme","theme",r.target.value),className:"mr-3"}),e.jsx("span",{className:"text-white/80 capitalize",children:s})]},s))})]})]}),t==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Dashboard Settings"}),e.jsx(F,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:Object.entries(d.dashboard).map(([s,r])=>s==="defaultTab"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 mb-2",children:"Default Tab"}),e.jsxs("select",{value:r,onChange:l=>x("dashboard",s,l.target.value),className:"w-full bg-gray-700 text-white rounded px-3 py-2",children:[e.jsx("option",{value:"dashboard",children:"Dashboard"}),e.jsx("option",{value:"piscines",children:"Piscines"}),e.jsx("option",{value:"leaderboard",children:"Leaderboard"}),e.jsx("option",{value:"groups",children:"Groups"}),e.jsx("option",{value:"audits",children:"Audits"}),e.jsx("option",{value:"checkpoints",children:"Checkpoints"}),e.jsx("option",{value:"events",children:"Events"}),e.jsx("option",{value:"export",children:"Export"})]})]},s):s==="tabOrder"?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-white/80",children:"Tab Order"}),e.jsx("button",{onClick:v,className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",children:"Reset to Default"})]}),e.jsx("div",{className:"space-y-2",children:r.map((l,i)=>{const c=j.find(C=>C.id===l);if(!c)return null;const y=c.icon;return e.jsxs("div",{className:"flex items-center bg-gray-700/50 rounded px-3 py-2",children:[e.jsx(W,{className:"w-4 h-4 text-white/40 mr-2"}),e.jsx(y,{className:"w-4 h-4 text-white/60 mr-2"}),e.jsx("span",{className:"text-white/80 flex-1",children:c.label}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>i>0&&S(i,i-1),disabled:i===0,className:"p-1 text-white/40 hover:text-white/60 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(X,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>i<r.length-1&&S(i,i+1),disabled:i===r.length-1,className:"p-1 text-white/40 hover:text-white/60 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(K,{className:"w-3 h-3"})})]})]},l)})})]},s):e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80 capitalize",children:s.replace(/([A-Z])/g," $1").trim()}),e.jsx("input",{type:"checkbox",checked:r,onChange:l=>x("dashboard",s,l.target.checked),className:"ml-3"})]},s))})})]}),t==="data"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Data Management"}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Refresh Settings"}),e.jsx("p",{className:"text-white/70 text-sm mb-4",children:"Manage data refresh settings, cache, and synchronization options."}),e.jsx(ae,{showStats:!0,showAutoRefreshToggle:!0})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Export Data"}),e.jsx("p",{className:"text-white/70 text-sm mb-4",children:"Export subjects and projects data in various formats for analysis or backup."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs(m.button,{onClick:k,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex items-center justify-center px-4 py-3 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/20 hover:border-blue-500/40 rounded-lg text-blue-200 transition-all duration-200",disabled:!p?.object?.length,children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),"Export as JSON"]}),e.jsxs(m.button,{onClick:T,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex items-center justify-center px-4 py-3 bg-green-600/20 hover:bg-green-600/30 border border-green-500/20 hover:border-green-500/40 rounded-lg text-green-200 transition-all duration-200",disabled:!p?.object?.length,children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Export as CSV"]})]}),p?.object?.length&&e.jsxs("div",{className:"mt-3 text-sm text-white/60 text-center",children:[p.object.length," subjects available for export"]}),!p?.object?.length&&!u&&e.jsx("div",{className:"mt-3 text-sm text-red-400 text-center",children:"No subjects data available for export"})]})]})]})]})]})})};export{pe as default};
