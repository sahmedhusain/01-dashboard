import{r as f,j as e,m as u}from"./animation-vendor-BWQ_wUI_.js";import{L as ne,f as I,a as O}from"./index-ChD3UmY2.js";import{h as q,B as G,T as z,x as oe,j as H,w as R,Z as Q,i as le,d as E,O as ce,Q as L,V as de,D as U,W as he,X as xe,Y as B,z as me,_ as pe,$ as ue}from"./ui-vendor-B1oIOTiF.js";import{d as be,e as ge}from"./apollo-vendor-8AJvV5pX.js";import"./react-vendor-DJG_os-6.js";const fe=ge`
  query GetAllPiscineData($userId: Int!) {
    piscineTransactions: transaction(
      where: {
        userId: { _eq: $userId }
        type: { _eq: "xp" }
        _or: [
          { path: { _like: "/bahrain/bh-piscine/%" } }
          { path: { _like: "/bahrain/bh-module/piscine-%" } }
          { 
            event: { 
              _or: [
                { path: { _like: "/bahrain/bh-piscine/%" } }
                { path: { _like: "/bahrain/bh-module/piscine-%" } }
              ]
            }
          }
        ]
        _not: { 
          _and: [
            { path: { _like: "%checkpoint%" } }
            { event: { path: { _like: "%checkpoint%" } } }
          ]
        }
      }
      order_by: { createdAt: desc }
    ) {
      id
      amount
      path
      createdAt
      type
      event {
        path
      }
    }
    piscineProgress: progress(
      where: {
        userId: { _eq: $userId }
        _or: [
          { path: { _like: "/bahrain/bh-piscine/%" } }  
          { path: { _like: "/bahrain/bh-module/piscine-%" } }
        ]
        _not: { path: { _like: "%checkpoint%" } }
      }
      order_by: { createdAt: desc }
    ) {
      id
      grade
      isDone
      path
      createdAt
    }
    piscineLevels: transaction(
      where: {
        userId: { _eq: $userId },
        type: { _eq: "level" },
        _or: [
          { path: { _like: "/bahrain/bh-piscine/%" } },
          { path: { _like: "/bahrain/bh-module/piscine-%" } }
        ]
      },
      order_by: { createdAt: desc }
    ) {
      id
      amount
      path
      createdAt
    }
    
    # Total Piscine XP using same method as DashboardSection
    totalPiscineXP: transaction_aggregate(
      where: {
        userId: { _eq: $userId }
        type: { _eq: "xp" }
        event: { path: { _like: "%piscine%" } }
      }
    ) {
      aggregate {
        sum {
          amount
        }
      }
    }
  }
`,M={go:{name:"Go Piscine",path:"/bahrain/bh-piscine/",icon:le,color:"from-blue-500 to-cyan-500"},js:{name:"JavaScript",path:"/bahrain/bh-module/piscine-js/",icon:Q,color:"from-yellow-500 to-orange-500"},flutter:{name:"Flutter",path:"/bahrain/bh-module/piscine-flutter/",icon:R,color:"from-blue-400 to-blue-600"},rust:{name:"Rust",path:"/bahrain/bh-module/piscine-rust/",icon:H,color:"from-orange-600 to-red-600"},ai:{name:"AI/ML",path:"/bahrain/bh-module/piscine-ai/",icon:oe,color:"from-purple-500 to-pink-500"},blockchain:{name:"Blockchain",path:"/bahrain/bh-module/piscine-blockchain/",icon:z,color:"from-green-500 to-emerald-500"},java:{name:"Java",path:"/bahrain/bh-module/piscine-java/",icon:G,color:"from-red-500 to-red-700"},ux:{name:"UX Design",path:"/bahrain/bh-module/piscine-ux/",icon:q,color:"from-pink-500 to-rose-500"},ui:{name:"UI Design",path:"/bahrain/bh-module/piscine-ui/",icon:q,color:"from-indigo-500 to-purple-500"}},v=({icon:A,title:h,value:y,color:w,subValue:N,trend:p,bgGradient:D})=>e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:`${D||`bg-gradient-to-br ${w} backdrop-blur-lg`} rounded-2xl p-6 border border-white/10 hover:border-white/20 transition-all duration-300 hover:transform hover:scale-105 shadow-lg hover:shadow-xl`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(A,{className:"w-8 h-8 text-white drop-shadow-lg"})}),p&&e.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-semibold ${p.isPositive?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:[p.isPositive?"↗":"↘"," ",Math.abs(p.value),"%"]})]}),e.jsx("h3",{className:"text-3xl font-bold text-white mb-2 tracking-tight",children:y}),e.jsx("p",{className:"text-white/80 text-sm font-medium",children:h}),N&&e.jsx("p",{className:"text-white/60 text-xs mt-2 bg-white/10 rounded-lg px-2 py-1",children:N})]}),ke=({user:A})=>{const[h,y]=f.useState("all"),[w,N]=f.useState(""),[p,D]=f.useState("date"),[P,J]=f.useState("desc"),[k,Y]=f.useState("all"),[S,Z]=f.useState(null),{data:j,loading:K,error:W}=be(fe,{variables:{userId:A.id},errorPolicy:"all",fetchPolicy:"cache-and-network"}),c=f.useMemo(()=>{if(!j)return null;const t=j.piscineTransactions||[],l=j.piscineProgress||[],i=j.piscineLevels||[],o=s=>{if(s.includes("/bahrain/bh-piscine/"))return"go";const a=s.match(/\/bahrain\/bh-module\/piscine-([^/]+)\//);return a?a[1]:"unknown"},x=s=>{if(!s)return{projectName:"Unknown Project",sectionName:"Unknown Section"};const a=s.split("/").filter(T=>T),n=a[a.length-1]||"Unknown Project";let g=a.length>1?a[a.length-2]:"Section";return s.includes("/bahrain/bh-piscine/")&&(g="Go Piscine"),{projectName:n,sectionName:g}},b={};l.forEach(s=>{const a=s.path;if(!b[a]){const{projectName:n,sectionName:g}=x(a);b[a]={path:a,projectName:n,sectionName:g,piscineType:o(a),attempts:[],totalXP:0,lastDate:s.createdAt}}b[a].attempts.push(s)}),t.forEach(s=>{const a=s.path||s.event?.path;if(a){if(!b[a]){const{projectName:n,sectionName:g}=x(a);b[a]={path:a,projectName:n,sectionName:g,piscineType:o(a),attempts:[],totalXP:0,lastDate:s.createdAt}}s.type==="xp"&&(b[a].totalXP+=s.amount||0)}}),Object.values(b).forEach(s=>{const a=s.attempts.some(n=>n.isDone&&n.grade>=1);s.status=a?"passed":s.attempts.some(n=>n.isDone)?"failed":"in-progress",s.failedAttempts=s.attempts.filter(n=>n.isDone&&n.grade<1).length});const m=Object.values(b),_={};Object.keys(M).forEach(s=>{const a=m.filter(d=>d.piscineType===s),n=a.filter(d=>d.status==="passed").length,g=a.reduce((d,$)=>d+$.totalXP,0),T=a.filter(d=>d.totalXP>0).length,ie=a.length-T,V=i.filter(d=>o(d.path)===s),re=V.length>0?V[0].amount:0;_[s]={totalXP:g,totalProjects:a.length,passedProjects:n,passRate:a.length>0?n/a.length*100:0,failedAttempts:a.reduce((d,$)=>d+$.failedAttempts,0),xpTransactions:T,nonXpTransactions:ie,level:re}});const F=m.filter(s=>s.totalXP>0).length,se=m.length-F,ae={totalXP:j.totalPiscineXP?.aggregate?.sum?.amount||0,totalProjects:m.length,passedProjects:m.filter(s=>s.status==="passed").length,passRate:m.length>0?m.filter(s=>s.status==="passed").length/m.length*100:0,failedAttempts:m.reduce((s,a)=>s+a.failedAttempts,0),xpTransactions:F,nonXpTransactions:se};return{projectList:m,piscineStats:_,availablePiscines:Object.keys(_).filter(s=>_[s].totalProjects>0),overallStats:ae}},[j]),C=f.useMemo(()=>{if(!c)return[];let t=c.projectList;if(h!=="all"&&(t=t.filter(l=>l.piscineType===h)),w){const l=w.toLowerCase();t=t.filter(i=>i.projectName.toLowerCase().includes(l))}return k!=="all"&&(t=t.filter(l=>l.status===k)),t.sort((l,i)=>{let o,x;return p==="date"?(o=new Date(l.lastDate||0).getTime(),x=new Date(i.lastDate||0).getTime()):p==="amount"?(o=l.totalXP,x=i.totalXP):(o=l.projectName.toLowerCase(),x=i.projectName.toLowerCase()),P==="asc"?o>x?1:-1:o<x?1:-1}),t},[c,h,w,k,p,P]);if(K)return e.jsx(ne,{});if(W||!c)return e.jsx("div",{children:"Error loading piscine data."});const r=h==="all"?c.overallStats:c.piscineStats[h]||c.overallStats,X=r.xpTransactions+r.nonXpTransactions,ee=X>0?r.xpTransactions/X*100:0,te=X>0?r.nonXpTransactions/X*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-cyan-900/20 to-slate-900 min-h-full relative",children:[e.jsxs("div",{className:"fixed inset-0 opacity-30 pointer-events-none z-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-cyan-500/5 to-blue-500/5"}),e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 45px 45px, rgba(6, 182, 212, 0.1) 2px, transparent 0)",backgroundSize:"90px 90px"}})]}),e.jsx("div",{className:"relative z-10 overflow-hidden",children:e.jsxs("div",{className:"relative space-y-8 p-6",children:[e.jsxs(u.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-full backdrop-blur-sm border border-white/10 mb-4",children:e.jsx(G,{className:"w-10 h-10 text-cyan-400"})}),e.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-white via-cyan-100 to-blue-100 bg-clip-text text-transparent",children:"Piscines Dashboard"}),e.jsxs("p",{className:"text-xl text-white/70 max-w-2xl mx-auto",children:["Dive deep into ",e.jsx("span",{className:"text-cyan-400 font-semibold",children:c.availablePiscines.length})," intensive coding piscines with ",e.jsx("span",{className:"text-cyan-400 font-semibold",children:I(c.overallStats.totalXP)})," total XP"]})]}),e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},className:"bg-gradient-to-r from-white/10 to-white/5 backdrop-blur-xl border border-white/20 rounded-3xl p-3 shadow-2xl",children:e.jsxs("div",{className:"flex space-x-3 overflow-x-auto scrollbar-hide",children:[e.jsxs(u.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>y("all"),className:`flex items-center px-8 py-4 text-sm font-bold rounded-2xl transition-all duration-300 whitespace-nowrap shadow-lg ${h==="all"?"bg-gradient-to-r from-cyan-500 via-blue-500 to-indigo-500 text-white shadow-cyan-500/30 border border-white/20":"bg-white/10 text-white/80 hover:text-white hover:bg-white/20 hover:shadow-xl border border-white/10"}`,children:[e.jsx(z,{className:"w-6 h-6 mr-3"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:"All Piscines"}),e.jsxs("div",{className:"text-xs opacity-80",children:["(",c.overallStats.totalProjects," exercises)"]})]})]}),c.availablePiscines.map((t,l)=>{const i=M[t];if(!i)return null;const o=i.icon,x=c.piscineStats[t];return e.jsxs(u.button,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.4+l*.1},whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>y(t),className:`flex items-center px-8 py-4 text-sm font-bold rounded-2xl transition-all duration-300 whitespace-nowrap shadow-lg ${h===t?`bg-gradient-to-r ${i.color} text-white shadow-lg border border-white/20`:"bg-white/10 text-white/80 hover:text-white hover:bg-white/20 hover:shadow-xl border border-white/10"}`,children:[e.jsx(o,{className:"w-6 h-6 mr-3"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:i.name}),e.jsxs("div",{className:"text-xs opacity-80",children:["(",x.totalProjects," exercises)"]})]})]},t)})]})}),e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-8 gap-6",children:[h!=="all"&&e.jsx(v,{icon:G,title:"Piscine Level",value:r.level||0,color:"from-gray-500/20 to-gray-600/20",bgGradient:"bg-gradient-to-br from-slate-800/50 to-slate-900/50",subValue:"Current achievement level"}),e.jsx(v,{icon:Q,title:"Total XP Earned",value:I(r.totalXP||0),color:"from-blue-500/20 to-blue-600/20",bgGradient:"bg-gradient-to-br from-blue-900/20 to-cyan-900/20",subValue:"Experience points gained"}),e.jsx(v,{icon:H,title:"Total Exercises",value:r.totalProjects||0,color:"from-green-500/20 to-green-600/20",bgGradient:"bg-gradient-to-br from-green-900/20 to-emerald-900/20",subValue:"Coding challenges attempted"}),e.jsx(v,{icon:E,title:"Passed Exercises",value:r.passedProjects||0,color:"from-purple-500/20 to-purple-600/20",bgGradient:"bg-gradient-to-br from-purple-900/20 to-violet-900/20",subValue:"Successfully completed"}),e.jsx(v,{icon:ce,title:"Success Rate",value:`${(r.passRate||0).toFixed(1)}%`,color:"from-yellow-500/20 to-yellow-600/20",bgGradient:"bg-gradient-to-br from-yellow-900/20 to-amber-900/20",trend:r.passRate>=75?{value:Math.round(r.passRate-60),isPositive:!0}:void 0,subValue:r.passRate>=75?"Outstanding!":r.passRate>=50?"Good progress":"Keep practicing"}),e.jsx(v,{icon:L,title:"Failed Attempts",value:r.failedAttempts||0,color:"from-red-500/20 to-red-600/20",bgGradient:"bg-gradient-to-br from-red-900/20 to-rose-900/20",subValue:"Learning opportunities"}),e.jsx(v,{icon:de,title:"XP Exercises",value:r.xpTransactions||0,color:"from-cyan-500/20 to-cyan-600/20",bgGradient:"bg-gradient-to-br from-cyan-900/20 to-teal-900/20",subValue:`${ee.toFixed(1)}% of total exercises`}),e.jsx(v,{icon:R,title:"Practice Exercises",value:r.nonXpTransactions||0,color:"from-indigo-500/20 to-indigo-600/20",bgGradient:"bg-gradient-to-br from-indigo-900/20 to-blue-900/20",subValue:`${te.toFixed(1)}% of total exercises`})]}),e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"bg-white/5 backdrop-blur-lg rounded-2xl p-6 border border-white/10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-white/50 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search by excersice name...",value:w,onChange:t=>N(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"w-4 h-4 text-white/70"}),e.jsxs("select",{value:k,onChange:t=>Y(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"passed",children:"Passed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"in-progress",children:"In Progress"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"w-4 h-4 text-white/70"}),e.jsxs("select",{value:p,onChange:t=>D(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"amount",children:"Sort by XP"}),e.jsx("option",{value:"path",children:"Sort by Name"})]}),e.jsx("button",{onClick:()=>J(P==="asc"?"desc":"asc"),className:"p-2 bg-white/10 rounded-lg hover:bg-white/20",children:e.jsx(B,{className:`w-4 h-4 transition-transform ${P==="asc"?"rotate-180":""}`})})]})]})]})}),e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-white/10",children:e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center",children:[e.jsx(R,{className:"w-6 h-6 mr-3 text-primary-400"}),"Exercises (",C.length,")"]})}),e.jsxs("div",{className:"max-h-[600px] overflow-y-auto",children:[C.map((t,l)=>e.jsxs("div",{className:"border-b border-white/5 last:border-b-0 p-6 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${t.status==="passed"?"bg-green-500/20":t.status==="failed"?"bg-red-500/20":"bg-yellow-500/20"}`,children:t.status==="passed"?e.jsx(E,{className:"w-6 h-6 text-green-400"}):t.status==="failed"?e.jsx(L,{className:"w-6 h-6 text-red-400"}):e.jsx(me,{className:"w-6 h-6 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-white",children:t.projectName}),e.jsx("p",{className:"text-white/60 text-sm",children:t.sectionName})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-2xl font-bold ${t.totalXP>0?"text-green-400":"text-white/60"}`,children:t.totalXP>0?`+${I(t.totalXP)}`:"No XP"}),e.jsx("p",{className:"text-white/60 text-sm",children:O(t.lastDate)}),t.attempts.length>1&&t.status==="passed"?e.jsxs("button",{onClick:()=>Z(S===t.path?null:t.path),className:"mt-2 flex items-center space-x-1 text-xs text-primary-400 hover:text-primary-300",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{children:S===t.path?"Hide attempts":`Show ${t.failedAttempts} failed attempt${t.failedAttempts!==1?"s":""}`}),S===t.path?e.jsx(ue,{className:"w-3 h-3"}):e.jsx(B,{className:"w-3 h-3"})]}):null]})]}),S===t.path&&e.jsx(u.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 bg-white/5 border border-white/10 rounded-lg p-4",children:e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:t.attempts.sort((i,o)=>new Date(o.createdAt).getTime()-new Date(i.createdAt).getTime()).map((i,o)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg ${i.grade>=1?"bg-green-500/10":"bg-red-500/10"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[i.grade>=1?e.jsx(E,{className:"w-4 h-4 text-green-400"}):e.jsx(L,{className:"w-4 h-4 text-red-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.grade>=1?"Passed":"Failed"}),e.jsxs("div",{className:"text-white/40 text-xs",children:["Attempt #",t.attempts.length-o]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-white/60 text-sm",children:["Grade: ",e.jsxs("span",{className:`font-semibold ${i.grade>=1?"text-green-400":"text-red-400"}`,children:[(i.grade*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"text-white/40 text-xs",children:O(i.createdAt)})]})]},i.id))})})]},t.path)),C.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx("h3",{className:"text-white/70 text-lg font-medium mb-2",children:"No Exercises found"}),e.jsx("p",{className:"text-white/50",children:"Try adjusting your search criteria or filters"})]})]})]})]})})]})};export{ke as default};
