# ============================================================================
# GROUP BASIC QUERIES
# Core group queries for team collaboration and project groups
# ============================================================================

# Get group by ID
query GetGroupById($groupId: Int!) {
  group(where: { id: { _eq: $groupId } }) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group captain
    captain {
      id
      login
      firstName
      lastName
      campus
      auditRatio
      totalUp
      totalDown
    }
    # Group members
    group_users {
      id
      userId
      groupId
      createdAt
      updatedAt
      user {
        id
        login
        firstName
        lastName
        campus
        auditRatio
        totalUp
        totalDown
      }
    }
    # Object/project the group is working on
    object {
      id
      name
      type
      status
      attrs
      campus
    }
    # Event context
    event {
      id
      path
      campus
      createdAt
      endAt
      status
    }
  }
}

# Get groups by status
query GetGroupsByStatus($status: String!, $limit: Int = 50, $offset: Int = 0) {
  group(
    where: { status: { _eq: $status } }
    order_by: { createdAt: desc }
    limit: $limit
    offset: $offset
  ) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group captain
    captain {
      id
      login
      firstName
      lastName
      campus
    }
    # Group member count
    group_users_aggregate {
      aggregate {
        count
      }
    }
    # Object/project the group is working on
    object {
      id
      name
      type
      status
      attrs
    }
    # Event context
    event {
      id
      path
      campus
    }
  }
}

# Get groups by campus
query GetGroupsByCampus($campus: String!, $limit: Int = 100, $offset: Int = 0) {
  group(
    where: { campus: { _eq: $campus } }
    order_by: { createdAt: desc }
    limit: $limit
    offset: $offset
  ) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group captain
    captain {
      id
      login
      firstName
      lastName
      campus
    }
    # Group member count
    group_users_aggregate {
      aggregate {
        count
      }
    }
    # Object/project the group is working on
    object {
      id
      name
      type
      status
      attrs
    }
    # Event context
    event {
      id
      path
      campus
    }
  }
}

# Get user's groups
query GetUserGroups($userLogin: String!, $limit: Int = 50) {
  group_user(
    where: { user: { login: { _eq: $userLogin } } }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    userId
    groupId
    createdAt
    updatedAt
    group {
      id
      status
      path
      campus
      createdAt
      updatedAt
      # Group captain
      captain {
        id
        login
        firstName
        lastName
        campus
      }
      # All group members
      group_users {
        id
        userId
        groupId
        createdAt
        updatedAt
        user {
          id
          login
          firstName
          lastName
          campus
        }
      }
      # Object/project the group is working on
      object {
        id
        name
        type
        status
        attrs
      }
      # Event context
      event {
        id
        path
        campus
        createdAt
        endAt
      }
    }
  }
}

# Get groups by object/project
query GetGroupsByObject($objectId: Int!, $limit: Int = 50) {
  group(
    where: { objectId: { _eq: $objectId } }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group captain
    captain {
      id
      login
      firstName
      lastName
      campus
    }
    # Group members
    group_users {
      confirmed
      createdAt
      user {
        id
        login
        firstName
        lastName
        campus
      }
    }
    # Event context
    event {
      id
      path
      campus
    }
  }
}

# Get groups by event
query GetGroupsByEvent($eventId: Int!, $limit: Int = 50) {
  group(
    where: { eventId: { _eq: $eventId } }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group captain
    captain {
      id
      login
      firstName
      lastName
      campus
    }
    # Group members
    group_users {
      confirmed
      createdAt
      user {
        id
        login
        firstName
        lastName
        campus
      }
    }
    # Object/project the group is working on
    object {
      id
      name
      type
      status
      attrs
    }
  }
}

# Get groups by captain
query GetGroupsByCaptain($captainLogin: String!, $limit: Int = 50) {
  group(
    where: { captain: { login: { _eq: $captainLogin } } }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group members
    group_users {
      confirmed
      createdAt
      user {
        id
        login
        firstName
        lastName
        campus
      }
    }
    # Object/project the group is working on
    object {
      id
      name
      type
      status
      attrs
    }
    # Event context
    event {
      id
      path
      campus
    }
  }
}

# Get active groups (working status)
query GetActiveGroups($limit: Int = 100, $offset: Int = 0) {
  group(
    where: { status: { _eq: "working" } }
    order_by: { createdAt: desc }
    limit: $limit
    offset: $offset
  ) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group captain
    captain {
      id
      login
      firstName
      lastName
      campus
    }
    # Group member count
    group_users_aggregate {
      aggregate {
        count
      }
    }
    # Object/project the group is working on
    object {
      id
      name
      type
      status
      attrs
    }
    # Event context
    event {
      id
      path
      campus
    }
  }
}

# Get groups with unconfirmed members
query GetGroupsWithUnconfirmedMembers($limit: Int = 50) {
  group(
    where: { 
      group_users: { 
        confirmed: { _eq: false } 
      }
    }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group captain
    captain {
      id
      login
      firstName
      lastName
      campus
    }
    # Group members (including unconfirmed)
    group_users {
      confirmed
      createdAt
      user {
        id
        login
        firstName
        lastName
        campus
      }
    }
    # Object/project the group is working on
    object {
      id
      name
      type
      status
      attrs
    }
    # Event context
    event {
      id
      path
      campus
    }
  }
}

# Get groups by date range
query GetGroupsByDateRange($startDate: timestamptz!, $endDate: timestamptz!, $limit: Int = 100) {
  group(
    where: { 
      createdAt: { _gte: $startDate, _lte: $endDate }
    }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    status
    path
    campus
    createdAt
    updatedAt
    # Group captain
    captain {
      id
      login
      firstName
      lastName
      campus
    }
    # Group member count
    group_users_aggregate {
      aggregate {
        count
      }
    }
    # Object/project the group is working on
    object {
      id
      name
      type
      status
      attrs
    }
    # Event context
    event {
      id
      path
      campus
    }
  }
}
