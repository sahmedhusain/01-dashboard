# ============================================================================
# RECORD QUERIES
# Queries for user records (bans, disciplinary actions)
# ============================================================================

# Get record by ID
query GetRecordById($recordId: Int!) {
  record(where: { id: { _eq: $recordId } }) {
    id
    message
    banEndAt
    createdAt
    # User the record is about
    user {
      id
      login
      firstName
      lastName
      campus
    }
    # Author of the record
    author {
      id
      login
      firstName
      lastName
      campus
    }
  }
}

# Get records for a user
query GetUserRecords($userLogin: String!, $limit: Int = 50) {
  record(
    where: { user: { login: { _eq: $userLogin } } }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    message
    banEndAt
    createdAt
    # Author of the record
    author {
      id
      login
      firstName
      lastName
      campus
    }
  }
}

# Get records by author
query GetRecordsByAuthor($authorLogin: String!, $limit: Int = 50) {
  record(
    where: { author: { login: { _eq: $authorLogin } } }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    message
    banEndAt
    createdAt
    # User the record is about
    user {
      id
      login
      firstName
      lastName
      campus
    }
  }
}

# Get active bans (banEndAt in the future)
query GetActiveBans($currentTime: timestamptz!, $limit: Int = 50) {
  record(
    where: { 
      banEndAt: { _gt: $currentTime }
    }
    order_by: { banEndAt: asc }
    limit: $limit
  ) {
    id
    message
    banEndAt
    createdAt
    # User the record is about
    user {
      id
      login
      firstName
      lastName
      campus
    }
    # Author of the record
    author {
      id
      login
      firstName
      lastName
      campus
    }
  }
}

# Get expired bans
query GetExpiredBans($currentTime: timestamptz!, $limit: Int = 100) {
  record(
    where: { 
      banEndAt: { _lt: $currentTime }
    }
    order_by: { banEndAt: desc }
    limit: $limit
  ) {
    id
    message
    banEndAt
    createdAt
    # User the record is about
    user {
      id
      login
      firstName
      lastName
      campus
    }
    # Author of the record
    author {
      id
      login
      firstName
      lastName
      campus
    }
  }
}

# Get records by campus
query GetRecordsByCampus($campus: String!, $limit: Int = 100) {
  record(
    where: { 
      _or: [
        { user: { campus: { _eq: $campus } } }
        { author: { campus: { _eq: $campus } } }
      ]
    }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    message
    banEndAt
    createdAt
    # User the record is about
    user {
      id
      login
      firstName
      lastName
      campus
    }
    # Author of the record
    author {
      id
      login
      firstName
      lastName
      campus
    }
  }
}

# Get records by date range
query GetRecordsByDateRange($startDate: timestamptz!, $endDate: timestamptz!, $limit: Int = 100) {
  record(
    where: { 
      createdAt: { _gte: $startDate, _lte: $endDate }
    }
    order_by: { createdAt: desc }
    limit: $limit
  ) {
    id
    message
    banEndAt
    createdAt
    # User the record is about
    user {
      id
      login
      firstName
      lastName
      campus
    }
    # Author of the record
    author {
      id
      login
      firstName
      lastName
      campus
    }
  }
}
