# Import required fragments
#import "../fragments/result-fragments.graphql"
#import "../fragments/object-fragments.graphql"
#import "../fragments/user-fragments.graphql"
#import "../fragments/audit-fragments.graphql"

# Enhanced user results query following official database structure
query GetUserResults($userId: Int!, $limit: Int = 50, $offset: Int = 0, $type: String = null, $minGrade: Float = null) {
  result(
    where: {
      userId: { _eq: $userId }
      type: { _eq: $type }
      grade: { _gte: $minGrade }
    }
    order_by: { updatedAt: desc }
    limit: $limit
    offset: $offset
  ) {
    ...ResultInfo
    # Related object information following official structure
    object {
      ...ObjectInfo
      # Author information
      author {
        ...UserInfo
      }
      # Reference relationships
      reference {
        id
        name
        type
        attrs
      }
    }
    # Related event information following official structure
    event {
      id
      path
      campus
      createdAt
      endAt
      # Parent event relationship
      parent {
        id
        path
        campus
      }
      # Registration information
      registration {
        id
        startAt
        endAt
        eventStartAt
      }
      # Related object
      object {
        id
        name
        type
        attrs
      }
    }
    # Related group information following official structure
    group {
      id
      status
      captainId
      createdAt
      updatedAt
      path
      campus
      # Group users following official group_user table structure
      groupUsers {
        id
        confirmed
        createdAt
        updatedAt
        user {
          ...UserInfo
        }
      }
      # Captain information
      captain {
        ...UserInfo
      }
    }
    # Related audits for this result following official audit table structure
    audits {
      ...AuditInfo
      # Auditor information
      auditor {
        ...UserInfo
      }
      # Related group
      group {
        id
        status
        captainId
        path
        campus
      }
    }
  }

  # Result statistics
  result_aggregate(
    where: {
      userId: { _eq: $userId }
      type: { _eq: $type }
    }
  ) {
    aggregate {
      count
      avg {
        grade
      }
      max {
        grade
      }
      min {
        grade
      }
    }
  }
}
